{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/rd96/OneDrive/Desktop/Social Media Clone/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/rd96/OneDrive/Desktop/Social Media Clone/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/rd96/OneDrive/Desktop/Social Media Clone/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useContext,useState}from\"react\";import\"./Comments.scss\";import{AuthContext}from\"../../context/authContext\";import{useQuery,useQueryClient,useMutation}from'@tanstack/react-query';import{makeRequest}from\"../../axios\";import moment from\"moment\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Comments=function Comments(_ref){var postId=_ref.postId;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),desc=_useState2[0],setDesc=_useState2[1];var _useContext=useContext(AuthContext),currentUser=_useContext.currentUser;var _useQuery=useQuery(['comments'],function(){return makeRequest.get(\"/comments?postId=\"+postId).then(function(res){return res.data;});}),isLoading=_useQuery.isLoading,error=_useQuery.error,data=_useQuery.data;console.log(data);var queryClient=useQueryClient();var mutation=useMutation(function(newComment){return makeRequest.post(\"/comments\",newComment);},{onSuccess:function onSuccess(){queryClient.invalidateQueries([\"comments\"]);}});var handleClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();mutation.mutate({desc:desc,postId:postId});setDesc(\"\");case 3:case\"end\":return _context.stop();}},_callee);}));return function handleClick(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"comments\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"userinput\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/upload/\"+currentUser.profilePic,alt:\"\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Write a comment\",value:desc,onChange:function onChange(e){return setDesc(e.target.value);}}),/*#__PURE__*/_jsx(\"button\",{onClick:handleClick,children:\"Send\"})]}),error?\"Something went wrong\":isLoading?\"loading\":data.map(function(comment){return/*#__PURE__*/_jsxs(\"div\",{className:\"comment\",children:[/*#__PURE__*/_jsx(\"img\",{src:comment.userId===currentUser.id?\"/upload/\"+currentUser.profilePic:\"/upload/\"+comment.profilePic,alt:\"\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"info\",children:[/*#__PURE__*/_jsx(\"span\",{children:comment.name}),/*#__PURE__*/_jsx(\"p\",{children:comment.desc})]}),/*#__PURE__*/_jsx(\"span\",{className:\"date\",children:moment(comment.createdAt).fromNow()})]},comment.id);})]});};export default Comments;","map":{"version":3,"names":["useContext","useState","AuthContext","useQuery","useQueryClient","useMutation","makeRequest","moment","jsx","_jsx","jsxs","_jsxs","Comments","_ref","postId","_useState","_useState2","_slicedToArray","desc","setDesc","_useContext","currentUser","_useQuery","get","then","res","data","isLoading","error","console","log","queryClient","mutation","newComment","post","onSuccess","invalidateQueries","handleClick","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","e","wrap","_callee$","_context","prev","next","preventDefault","mutate","stop","_x","apply","arguments","className","children","src","profilePic","alt","type","placeholder","value","onChange","target","onClick","map","comment","userId","id","name","createdAt","fromNow"],"sources":["C:/Users/rd96/OneDrive/Desktop/Social Media Clone/client/src/components/Comments/Comments.jsx"],"sourcesContent":["import { useContext, useState } from \"react\";\r\nimport \"./Comments.scss\";\r\nimport { AuthContext } from \"../../context/authContext\";\r\nimport { useQuery, useQueryClient, useMutation } from '@tanstack/react-query';\r\nimport { makeRequest } from \"../../axios\";\r\nimport moment from \"moment\";\r\n\r\n\r\nconst Comments = ({ postId }) => {\r\n  const [desc, setDesc] = useState(\"\");\r\n  const { currentUser } = useContext(AuthContext);\r\n\r\n  const { isLoading, error, data } = useQuery(['comments'], () =>\r\n    makeRequest.get(\"/comments?postId=\" + postId).then((res => {\r\n      return res.data;\r\n    }))\r\n  );\r\n\r\n  console.log(data)\r\n\r\n  const queryClient = useQueryClient();\r\n\r\n  const mutation = useMutation(\r\n    (newComment) => {\r\n      return makeRequest.post(\"/comments\", newComment);\r\n    },\r\n    {\r\n      onSuccess: () => {\r\n        queryClient.invalidateQueries([\"comments\"]);\r\n      },\r\n    }\r\n  );\r\n\r\n  const handleClick = async (e) => {\r\n    e.preventDefault();\r\n    mutation.mutate({ desc, postId });\r\n    setDesc(\"\");\r\n  };\r\n\r\n  return (\r\n    <div className=\"comments\">\r\n      <div className=\"userinput\">\r\n        <img src={\"/upload/\" + currentUser.profilePic} alt=\"\" />\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Write a comment\"\r\n          value={desc}\r\n          onChange={e => setDesc(e.target.value)}\r\n        />\r\n        <button onClick={handleClick}>Send</button>\r\n      </div>\r\n      {error ? \"Something went wrong\" : isLoading ? \"loading\" : data.map((comment) => (\r\n        <div className=\"comment\" key={comment.id}>\r\n          <img src={comment.userId === currentUser.id ? \"/upload/\" + currentUser.profilePic : \"/upload/\" + comment.profilePic} alt=\"\" />\r\n          <div className=\"info\">\r\n            <span>{comment.name}</span>\r\n            <p>{comment.desc}</p>\r\n          </div>\r\n          <span className=\"date\">{moment(comment.createdAt).fromNow()}</span>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Comments;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}